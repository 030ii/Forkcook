<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="order">
	<select id="orderTotalCount" resultType="int">
		select count(distinct ordernum) from orders
	</select>
	<select id="orderNowTotalCount" parameterType="int" resultType="int">
		select count(distinct ordernum) from orders 
		where ordertype = 'A' and snum = #{snum}
	</select>
	<select id="orderReserveTotalCount" parameterType="int" resultType="int">
		select count(distinct ordernum) from orders
		where ordertype = 'B' and snum = #{snum}
	</select>
	<select id="orderFinishTotalCount" parameterType="int" resultType="int">
		select count(distinct ordernum) from orders
		where orderstate = 4 and snum = #{snum}
	</select>
	<insert id="orderInsert">
	
	</insert>
	<update id="orderUpdate">
	
	</update>
	<select id="orderList" resultType="odto">
		select distinct o.ordernum, u.name as uname, u.phone as uphone, o.snum, s.name as sname, o.ordertype, o.orderdate, o.orderstate, g.totalprice	
		from orders o, users u, store s, (select o.ordernum, sum(o.mtotalprice) as totalprice from orders o group by o.ordernum) g
		where o.unum = u.num and o.snum = s.num and o.ordernum = g.ordernum order by o.orderdate desc
	</select>
	<select id="orderListData" parameterType="String" resultType="odto">
		select distinct o.ordernum, u.name as uname, u.phone as uphone, s.name as sname, o.ordertype, o.orderdate, o.orderstate, g.totalcount, g.totalprice	
		from orders o, users u, store s, (select o.ordernum, sum(o.mcount) as totalcount, sum(o.mtotalprice) as totalprice from orders o group by o.ordernum) g
		where o.unum = u.num and o.snum = s.num and o.ordernum = g.ordernum and o.ordernum = #{ordernum,jdbcType=VARCHAR}
	</select>
	<select id="orderMenuData" parameterType="String" resultType="odto">
		select m.name as mname, o.mcount, o.mtotalprice 
		from orders o, menu m
		where o.mnum = m.num and o.ordernum = #{ordernum,jdbcType=VARCHAR}
	</select>
	<delete id="orderDelete" parameterType="String">
		delete from orders where ordernum = #{ordernum,jdbcType=VARCHAR}
	</delete>
</mapper>